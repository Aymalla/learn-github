name: Upload Build Artifact

on:
  workflow_call:
    inputs:
      path:
        description: "The path to the artifact to upload."
        required: true
      artifact_name:
        description: "The name of the artifact to upload."
        required: true

jobs:
  upload-build-artifact:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: 🛠️ Checkout Code
        uses: actions/checkout@v4

      - name: 📦 Upload Build Artifact - GitHub
        uses: actions/upload-artifact@v2
        with:
          name: ${{ inputs.artifact_name }}
          path: ${{ inputs.path }}

      - name: 🗜️ Artifact - Zip Folder
        run: |
          # name of the zip file can be replaced with hash of the commit to support versioning
          rm -rf ${{ inputs.artifact_name }}.zip 
          zip -r ${{ inputs.artifact_name }}.zip ${{ github.workspace }}/src/web-app/publish

      - name: 📦 Upload Build Artifact - Azure Storage
        uses: bacongobbler/azure-blob-storage-upload@main
        with:
          connection_string : ${{ secrets.AZURE_STORAGE_CONNECTION_STRING }}
          source_dir: '.'
          container_name: artifacts
          extra_args: '--pattern *.zip'
          overwrite: 'true'
